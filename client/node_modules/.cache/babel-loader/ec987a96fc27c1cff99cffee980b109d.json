{"ast":null,"code":"import _regeneratorRuntime from\"/Users/michalwanto/Desktop/Testing-Trial/client/node_modules/babel-preset-react-app/node_modules/@babel/runtime/regenerator\";import _objectSpread from\"/Users/michalwanto/Desktop/Testing-Trial/client/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/objectSpread2\";var _marked=/*#__PURE__*/_regeneratorRuntime.mark(getSnapshotFromUserAuth),_marked2=/*#__PURE__*/_regeneratorRuntime.mark(signOut),_marked3=/*#__PURE__*/_regeneratorRuntime.mark(isUserAuthenticated),_marked4=/*#__PURE__*/_regeneratorRuntime.mark(signInWithGoogle),_marked5=/*#__PURE__*/_regeneratorRuntime.mark(signInWithEmail),_marked6=/*#__PURE__*/_regeneratorRuntime.mark(signUp),_marked7=/*#__PURE__*/_regeneratorRuntime.mark(signInAfterSignUp),_marked8=/*#__PURE__*/_regeneratorRuntime.mark(onSignInWithGoogleStart),_marked9=/*#__PURE__*/_regeneratorRuntime.mark(onSignInWithEmailStart),_marked10=/*#__PURE__*/_regeneratorRuntime.mark(onCheckCurrentUser),_marked11=/*#__PURE__*/_regeneratorRuntime.mark(onSignOutStart),_marked12=/*#__PURE__*/_regeneratorRuntime.mark(onSignUpStart),_marked13=/*#__PURE__*/_regeneratorRuntime.mark(onSignUpSuccess),_marked14=/*#__PURE__*/_regeneratorRuntime.mark(userSagas);import{all,put,takeLatest,call}from\"redux-saga/effects\";import UserActionTypes from\"./user.types\";import{auth,googleProvider,createUserProfileDocument,getCurrentUser}from\"../../firebase/firebase.utils\";import{signInSuccess,signInFailure,signOutSuccess,signOutFailure,signUpSuccess,signUpFailure}from\"./user.actions\";import{addCartToFirestoreAsync}from\"../cart/cart.sagas\";import{fetchCartItemsFromFirestoreStart}from\"../cart/cart.actions\";export function getSnapshotFromUserAuth(userAuth,additionalData){var userRef,snapshot;return _regeneratorRuntime.wrap(function getSnapshotFromUserAuth$(_context){while(1){switch(_context.prev=_context.next){case 0:_context.prev=0;_context.next=3;return call(createUserProfileDocument,userAuth,additionalData);case 3:userRef=_context.sent;_context.next=6;return userRef.get();case 6:snapshot=_context.sent;_context.next=9;return put(signInSuccess(_objectSpread({id:snapshot.id},snapshot.data())));case 9:_context.next=11;return put(fetchCartItemsFromFirestoreStart());case 11:_context.next=17;break;case 13:_context.prev=13;_context.t0=_context[\"catch\"](0);_context.next=17;return put(signInFailure(_context.t0));case 17:case\"end\":return _context.stop();}}},_marked,null,[[0,13]]);}export function signOut(cartItems){return _regeneratorRuntime.wrap(function signOut$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:_context2.prev=0;_context2.next=3;return addCartToFirestoreAsync(cartItems);case 3:_context2.next=5;return auth.signOut();case 5:_context2.next=7;return put(signOutSuccess());case 7:_context2.next=13;break;case 9:_context2.prev=9;_context2.t0=_context2[\"catch\"](0);_context2.next=13;return put(signOutFailure(_context2.t0));case 13:case\"end\":return _context2.stop();}}},_marked2,null,[[0,9]]);}export function isUserAuthenticated(){var userAuth;return _regeneratorRuntime.wrap(function isUserAuthenticated$(_context3){while(1){switch(_context3.prev=_context3.next){case 0:_context3.prev=0;_context3.next=3;return getCurrentUser();case 3:userAuth=_context3.sent;if(userAuth){_context3.next=6;break;}return _context3.abrupt(\"return\");case 6:_context3.next=8;return getSnapshotFromUserAuth(userAuth);case 8:_context3.next=14;break;case 10:_context3.prev=10;_context3.t0=_context3[\"catch\"](0);_context3.next=14;return put(signInFailure(_context3.t0));case 14:case\"end\":return _context3.stop();}}},_marked3,null,[[0,10]]);}export function signInWithGoogle(){var _yield$auth$signInWit,user;return _regeneratorRuntime.wrap(function signInWithGoogle$(_context4){while(1){switch(_context4.prev=_context4.next){case 0:_context4.prev=0;_context4.next=3;return auth.signInWithPopup(googleProvider);case 3:_yield$auth$signInWit=_context4.sent;user=_yield$auth$signInWit.user;_context4.next=7;return getSnapshotFromUserAuth(user);case 7:_context4.next=13;break;case 9:_context4.prev=9;_context4.t0=_context4[\"catch\"](0);_context4.next=13;return put(signOutFailure(_context4.t0));case 13:case\"end\":return _context4.stop();}}},_marked4,null,[[0,9]]);}export function signInWithEmail(_ref){var _ref$payload,email,password,_yield$auth$signInWit2,user;return _regeneratorRuntime.wrap(function signInWithEmail$(_context5){while(1){switch(_context5.prev=_context5.next){case 0:_ref$payload=_ref.payload,email=_ref$payload.email,password=_ref$payload.password;_context5.prev=1;_context5.next=4;return auth.signInWithEmailAndPassword(email,password);case 4:_yield$auth$signInWit2=_context5.sent;user=_yield$auth$signInWit2.user;_context5.next=8;return getSnapshotFromUserAuth(user);case 8:_context5.next=14;break;case 10:_context5.prev=10;_context5.t0=_context5[\"catch\"](1);_context5.next=14;return put(signInFailure());case 14:case\"end\":return _context5.stop();}}},_marked5,null,[[1,10]]);}export function signUp(_ref2){var _ref2$payload,email,password,displayName,_yield$auth$createUse,user;return _regeneratorRuntime.wrap(function signUp$(_context6){while(1){switch(_context6.prev=_context6.next){case 0:_ref2$payload=_ref2.payload,email=_ref2$payload.email,password=_ref2$payload.password,displayName=_ref2$payload.displayName;_context6.prev=1;_context6.next=4;return auth.createUserWithEmailAndPassword(email,password);case 4:_yield$auth$createUse=_context6.sent;user=_yield$auth$createUse.user;_context6.next=8;return put(signUpSuccess({user:user,additionalData:{displayName:displayName}}));case 8:_context6.next=14;break;case 10:_context6.prev=10;_context6.t0=_context6[\"catch\"](1);_context6.next=14;return put(signUpFailure(_context6.t0));case 14:case\"end\":return _context6.stop();}}},_marked6,null,[[1,10]]);}export function signInAfterSignUp(_ref3){var _ref3$payload,user,additionalData;return _regeneratorRuntime.wrap(function signInAfterSignUp$(_context7){while(1){switch(_context7.prev=_context7.next){case 0:_ref3$payload=_ref3.payload,user=_ref3$payload.user,additionalData=_ref3$payload.additionalData;_context7.next=3;return getSnapshotFromUserAuth(user,additionalData);case 3:case\"end\":return _context7.stop();}}},_marked7);}export function onSignInWithGoogleStart(){return _regeneratorRuntime.wrap(function onSignInWithGoogleStart$(_context8){while(1){switch(_context8.prev=_context8.next){case 0:_context8.next=2;return takeLatest(UserActionTypes.SIGN_IN_WITH_GOOGLE_START,signInWithGoogle);case 2:case\"end\":return _context8.stop();}}},_marked8);}export function onSignInWithEmailStart(){return _regeneratorRuntime.wrap(function onSignInWithEmailStart$(_context9){while(1){switch(_context9.prev=_context9.next){case 0:_context9.next=2;return takeLatest(UserActionTypes.SIGN_IN_WITH_EMAIL_START,signInWithEmail);case 2:case\"end\":return _context9.stop();}}},_marked9);}export function onCheckCurrentUser(){return _regeneratorRuntime.wrap(function onCheckCurrentUser$(_context10){while(1){switch(_context10.prev=_context10.next){case 0:_context10.next=2;return takeLatest(UserActionTypes.CHECK_CURRENT_USER,isUserAuthenticated);case 2:case\"end\":return _context10.stop();}}},_marked10);}export function onSignOutStart(){return _regeneratorRuntime.wrap(function onSignOutStart$(_context11){while(1){switch(_context11.prev=_context11.next){case 0:_context11.next=2;return takeLatest(UserActionTypes.SIGN_OUT_START,signOut);case 2:case\"end\":return _context11.stop();}}},_marked11);}export function onSignUpStart(){return _regeneratorRuntime.wrap(function onSignUpStart$(_context12){while(1){switch(_context12.prev=_context12.next){case 0:_context12.next=2;return takeLatest(UserActionTypes.SIGN_UP_START,signUp);case 2:case\"end\":return _context12.stop();}}},_marked12);}export function onSignUpSuccess(){return _regeneratorRuntime.wrap(function onSignUpSuccess$(_context13){while(1){switch(_context13.prev=_context13.next){case 0:_context13.next=2;return takeLatest(UserActionTypes.SIGN_UP_SUCCESS,signInAfterSignUp);case 2:case\"end\":return _context13.stop();}}},_marked13);}export function userSagas(){return _regeneratorRuntime.wrap(function userSagas$(_context14){while(1){switch(_context14.prev=_context14.next){case 0:_context14.next=2;return all([call(onSignInWithGoogleStart),call(onSignInWithEmailStart),call(onCheckCurrentUser),call(onSignOutStart),call(onSignUpStart),call(onSignUpSuccess)]);case 2:case\"end\":return _context14.stop();}}},_marked14);}","map":{"version":3,"sources":["/Users/michalwanto/Desktop/Testing-Trial/client/src/redux/user/user.sagas.js"],"names":["getSnapshotFromUserAuth","signOut","isUserAuthenticated","signInWithGoogle","signInWithEmail","signUp","signInAfterSignUp","onSignInWithGoogleStart","onSignInWithEmailStart","onCheckCurrentUser","onSignOutStart","onSignUpStart","onSignUpSuccess","userSagas","all","put","takeLatest","call","UserActionTypes","auth","googleProvider","createUserProfileDocument","getCurrentUser","signInSuccess","signInFailure","signOutSuccess","signOutFailure","signUpSuccess","signUpFailure","addCartToFirestoreAsync","fetchCartItemsFromFirestoreStart","userAuth","additionalData","userRef","get","snapshot","id","data","cartItems","signInWithPopup","user","payload","email","password","signInWithEmailAndPassword","displayName","createUserWithEmailAndPassword","SIGN_IN_WITH_GOOGLE_START","SIGN_IN_WITH_EMAIL_START","CHECK_CURRENT_USER","SIGN_OUT_START","SIGN_UP_START","SIGN_UP_SUCCESS"],"mappings":"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","sourcesContent":["import { all, put, takeLatest, call } from \"redux-saga/effects\";\n\nimport UserActionTypes from \"./user.types\";\n\nimport {\n  auth,\n  googleProvider,\n  createUserProfileDocument,\n  getCurrentUser,\n} from \"../../firebase/firebase.utils\";\n\nimport {\n  signInSuccess,\n  signInFailure,\n  signOutSuccess,\n  signOutFailure,\n  signUpSuccess,\n  signUpFailure,\n} from \"./user.actions\";\n\nimport { addCartToFirestoreAsync } from \"../cart/cart.sagas\";\nimport { fetchCartItemsFromFirestoreStart } from \"../cart/cart.actions\";\n\nexport function* getSnapshotFromUserAuth(userAuth, additionalData) {\n  try {\n    const userRef = yield call(\n      createUserProfileDocument,\n      userAuth,\n      additionalData\n    );\n    const snapshot = yield userRef.get();\n    yield put(signInSuccess({ id: snapshot.id, ...snapshot.data() }));\n    yield put(fetchCartItemsFromFirestoreStart());\n  } catch (error) {\n    yield put(signInFailure(error));\n  }\n}\n\nexport function* signOut(cartItems) {\n  try {\n    yield addCartToFirestoreAsync(cartItems);\n    yield auth.signOut();\n    yield put(signOutSuccess());\n  } catch (error) {\n    yield put(signOutFailure(error));\n  }\n}\n\nexport function* isUserAuthenticated() {\n  try {\n    const userAuth = yield getCurrentUser();\n    if (!userAuth) {\n      return;\n    }\n    yield getSnapshotFromUserAuth(userAuth);\n  } catch (error) {\n    yield put(signInFailure(error));\n  }\n}\n\nexport function* signInWithGoogle() {\n  try {\n    const { user } = yield auth.signInWithPopup(googleProvider);\n    yield getSnapshotFromUserAuth(user);\n  } catch (error) {\n    yield put(signOutFailure(error));\n  }\n}\n\nexport function* signInWithEmail({ payload: { email, password } }) {\n  try {\n    const { user } = yield auth.signInWithEmailAndPassword(email, password);\n    yield getSnapshotFromUserAuth(user);\n  } catch (error) {\n    yield put(signInFailure());\n  }\n}\n\nexport function* signUp({ payload: { email, password, displayName } }) {\n  try {\n    const { user } = yield auth.createUserWithEmailAndPassword(email, password);\n    yield put(signUpSuccess({ user, additionalData: { displayName } }));\n  } catch (error) {\n    yield put(signUpFailure(error));\n  }\n}\n\nexport function* signInAfterSignUp({ payload: { user, additionalData } }) {\n  yield getSnapshotFromUserAuth(user, additionalData);\n}\n\nexport function* onSignInWithGoogleStart() {\n  yield takeLatest(UserActionTypes.SIGN_IN_WITH_GOOGLE_START, signInWithGoogle);\n}\nexport function* onSignInWithEmailStart() {\n  yield takeLatest(UserActionTypes.SIGN_IN_WITH_EMAIL_START, signInWithEmail);\n}\nexport function* onCheckCurrentUser() {\n  yield takeLatest(UserActionTypes.CHECK_CURRENT_USER, isUserAuthenticated);\n}\nexport function* onSignOutStart() {\n  yield takeLatest(UserActionTypes.SIGN_OUT_START, signOut);\n}\n\nexport function* onSignUpStart() {\n  yield takeLatest(UserActionTypes.SIGN_UP_START, signUp);\n}\nexport function* onSignUpSuccess() {\n  yield takeLatest(UserActionTypes.SIGN_UP_SUCCESS, signInAfterSignUp);\n}\n\nexport function* userSagas() {\n  yield all([\n    call(onSignInWithGoogleStart),\n    call(onSignInWithEmailStart),\n    call(onCheckCurrentUser),\n    call(onSignOutStart),\n    call(onSignUpStart),\n    call(onSignUpSuccess),\n  ]);\n}\n"]},"metadata":{},"sourceType":"module"}